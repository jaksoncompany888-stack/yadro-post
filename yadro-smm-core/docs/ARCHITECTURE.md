# Yadro v0

AI-–∞–≥–µ–Ω—Ç —Å –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π, LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∏ Telegram –±–æ—Ç–æ–º.

## –ì–õ–ê–í–ù–´–ô –ü–†–ò–ù–¶–ò–ü: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ > –ü—Ä–æ–º–ø—Ç—ã

**–ú–∏–Ω–∏–º—É–º –ø—Ä–æ–º–ø—Ç–æ–≤, –º–∞–∫—Å–∏–º—É–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.**

–≠—Ç–æ –Ω–µ prompt-based –∞–≥–µ–Ω—Ç, –∞ architecture-based:
- **–õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ** ‚Äî Plan/Step/Tools –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –ß–¢–û –¥–µ–ª–∞—Ç—å
- **–ü—Ä–æ–º–ø—Ç—ã —Ñ–æ—Ä–º–∞–ª—å–Ω—ã** ‚Äî LLM —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª–Ω—è–µ—Ç —à–∞–≥–∏, –Ω–µ —Ä–µ—à–∞–µ—Ç
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî —Å–º–µ–Ω–∞ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è

```
–ü–õ–û–•–û (prompt-based):
  "–¢—ã SMM-–∞–≥–µ–Ω—Ç. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–∞–Ω–∞–ª, –Ω–∞–π–¥–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —Å–≥–µ–Ω–µ—Ä–∏ –ø–æ—Å—Ç..."
  ‚Üí –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ –ø—Ä–æ–º–ø—Ç–µ, –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è

–•–û–†–û–®–û (architecture-based):
  Plan: [parse_channel] ‚Üí [extract_metrics] ‚Üí [analyze_patterns] ‚Üí [generate]
  ‚Üí –ö–∞–∂–¥—ã–π —à–∞–≥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º, –ø—Ä–æ–º–ø—Ç –º–∏–Ω–∏–º–∞–ª–µ–Ω
```

**–ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—à—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
1. –°–Ω–∞—á–∞–ª–∞ ‚Äî –∫–∞–∫–∏–µ Steps –Ω—É–∂–Ω—ã?
2. –ü–æ—Ç–æ–º ‚Äî –∫–∞–∫–∏–µ Tools?
3. –í –∫–æ–Ω—Ü–µ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM —à–∞–≥–∞

**–í–ê–ñ–ù–û: –ü—Ä–æ–º–ø—Ç—ã –ù–ï –∑–∞–ø—Ä–µ—â–µ–Ω—ã!**
- –ü—Ä–æ–º–ø—Ç—ã ‚Äî —ç—Ç–æ fallback –∫–æ–≥–¥–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–π —Ä–µ—à–∏—Ç—å –∫–æ–¥–æ–º (regex, –ø–∞—Ä—Å–∏–Ω–≥, –ø—Ä–∞–≤–∏–ª–∞)
- –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π ‚Üí LLM —Å —á—ë—Ç–∫–∏–º –ø—Ä–æ–º–ø—Ç–æ–º
- –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º: —á—Ç–æ –¥–µ–ª–∞—Ç—å, —á–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å
- –ù–ï –±—Ä–æ—Å–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –ù–ï –±–µ–≥–∏ –≤ –ø—Ä–æ–º–ø—Ç—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

**–ü–∞—Ç—Ç–µ—Ä–Ω: LLM –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç**

–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ (–≥–æ–ª–æ—Å, —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç):
```
–ü–õ–û–•–û:
  LLM –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç + –∑–∞–ø—Ä–æ—Å ‚Üí LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
  ‚Üí LLM –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å–µ–±—è—Ç–∏–Ω—É, –º–µ–Ω—è–µ—Ç —á—Ç–æ –Ω–µ –ø—Ä–æ—Å–∏–ª–∏

–•–û–†–û–®–û:
  LLM –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç + –∑–∞–ø—Ä–æ—Å ‚Üí LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ó–ê–ú–ï–ù–´ [{old, new}, ...]
  ‚Üí –ö–æ–¥ –ü–†–û–í–ï–†–Ø–ï–¢: old —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ?
  ‚Üí –ö–æ–¥ –ü–†–ò–ú–ï–ù–Ø–ï–¢ —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –∑–∞–º–µ–Ω—ã
  ‚Üí –ù–∏–∫–∞–∫–æ–π –æ—Ç—Å–µ–±—è—Ç–∏–Ω—ã ‚Äî LLM –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç, –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç
```

–ü—Ä–∏–º–µ—Ä (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ ‚Äî –≥–∏–±—Ä–∏–¥ v7):
```python
# –ó–∞–ø—Ä–æ—Å: "—É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏ –∏ –¥–æ–±–∞–≤—å —Ö—É–∫"

# 1. –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
parts = _split_edit_request("—É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏ –∏ –¥–æ–±–∞–≤—å —Ö—É–∫")
# ‚Üí ["—É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏", "–¥–æ–±–∞–≤—å —Ö—É–∫"]

# 2. –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å
_is_precise_edit("—É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏")  # ‚Üí True (regex)
_is_precise_edit("–¥–æ–±–∞–≤—å —Ö—É–∫")     # ‚Üí False (–Ω—É–∂–µ–Ω LLM)

# 3. –°–Ω–∞—á–∞–ª–∞ –í–°–ï precise –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫–æ–¥, –±–µ–∑ LLM)
result = _precise_edit(text, "—É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏")
# ‚Üí —Ö—ç—à—Ç–µ–≥–∏ —É–¥–∞–ª–µ–Ω—ã

# 4. –ü–æ—Ç–æ–º creative (LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç)
result = _creative_edit(result, "–¥–æ–±–∞–≤—å —Ö—É–∫")
# ‚Üí —Ö—É–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–±–∑–∞—Ü
```

## –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Claude

- **–ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∞–º
- **–ù–ï –¥–µ–ª–∞—Ç—å pkill/kill** –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞ –±–µ–∑ —è–≤–Ω–æ–π –ø—Ä–æ—Å—å–±—ã
- **–ù–ï –ª–æ–º–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞** ‚Äî Executor, Plan, Step, Tools, Memory
- **–ü—Ä–æ–º–ø—Ç—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã** ‚Äî –ª–æ–≥–∏–∫–∞ –≤ Steps, –Ω–µ –≤ —Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–º–ø—Ç–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (8 —Å–ª–æ—ë–≤)

```
Layer 0: Storage     (app/storage/)     - SQLite + —Ñ–∞–π–ª—ã
Layer 1: Interfaces  (app/interfaces/)  - Telegram –±–æ—Ç
Layer 2: Kernel      (app/kernel/)      - Task State Machine
Layer 2b: Scheduler  (app/scheduler/)   - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á
Layer 3: Executor    (app/executor/)    - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
Layer 4: Tools       (app/tools/)       - –ë—Ä–∞—É–∑–µ—Ä, –ø–æ–∏—Å–∫, SMM tools
Layer 5: LLM         (app/llm/)         - OpenAI, —Ä–æ—É—Ç–∏–Ω–≥, –ª–∏–º–∏—Ç—ã
Layer 6: Memory      (app/memory/)      - –ü–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, FTS5
Layer 7: Providers   (app/providers/)   - –°–æ—Ü—Å–µ—Ç–∏: Telegram, VK, Instagram
```

## Providers ‚Äî –ú—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∏–Ω–≥

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–∞ Postiz, 26k+ –∑–≤—ë–∑–¥):

```
app/providers/
‚îú‚îÄ‚îÄ __init__.py      # –≠–∫—Å–ø–æ—Ä—Ç—ã
‚îú‚îÄ‚îÄ base.py          # SocialProvider (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å)
‚îú‚îÄ‚îÄ telegram.py      # TelegramProvider (Bot API)
‚îú‚îÄ‚îÄ vk.py            # VKProvider (VK API + OAuth2)
‚îú‚îÄ‚îÄ manager.py       # ProviderManager (–∫—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥)
‚îî‚îÄ‚îÄ instagram.py     # TODO
```

### SocialProvider (–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å)

```python
class SocialProvider(ABC):
    name: str = "base"
    max_text_length: int = 4096
    max_media_per_post: int = 10
    supports_media: bool = True
    supports_scheduling: bool = False

    @abstractmethod
    async def post(channel_id, text, media) -> PostResult

    @abstractmethod
    async def validate_channel(channel_id) -> bool

    async def delete_post(channel_id, post_id) -> bool
    async def edit_post(channel_id, post_id, new_text) -> PostResult
    async def schedule_post(channel_id, text, scheduled_time) -> PostResult
```

### TelegramProvider

```python
provider = TelegramProvider(bot_token="123:ABC")

# –ü–æ—Å—Ç–∏–Ω–≥
result = await provider.post("@mychannel", "Hello!")
# ‚Üí PostResult(success=True, post_id="123", url="https://t.me/mychannel/123")

# –° –º–µ–¥–∏–∞
media = [MediaItem(type=MediaType.IMAGE, url="https://...")]
result = await provider.post("@channel", "Caption", media=media)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
valid = await provider.validate_channel("@mychannel")

# HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
text = provider.format_text("**bold** and *italic*")
# ‚Üí "<b>bold</b> and <i>italic</i>"
```

### VKProvider

```python
provider = VKProvider(app_id="123", app_secret="secret")

# 1. –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è OAuth
auth_url, state = provider.get_auth_url("https://mysite.com/callback")
# ‚Üí "https://oauth.vk.com/authorize?client_id=123&..."

# 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è, –ø–æ–ª—É—á–∞–µ–º code
token = await provider.exchange_code(code, redirect_uri)

# 3. –ü–æ—Å—Ç–∏–Ω–≥ –≤ –≥—Ä—É–ø–ø—É
provider.set_token(token)
result = await provider.post("-123456", "–ü—Ä–∏–≤–µ—Ç –í–ö!")

# –ü–æ–ª—É—á–∏—Ç—å —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –≥—Ä—É–ø–ø—ã
groups = await provider.get_managed_groups()
# ‚Üí [VKGroup(id=123, name="–ú–æ—è –≥—Ä—É–ø–ø–∞", can_post=True), ...]
```

### ProviderManager (–∫—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥)

```python
manager = ProviderManager()

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
manager.register_provider("telegram", TelegramProvider(bot_token="..."))
manager.register_provider("vk", VKProvider(app_id="...", app_secret="..."))

# –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–∞–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
manager.add_channel(user_id=1, channel=UserChannel(
    platform=Platform.TELEGRAM,
    channel_id="@mychannel",
    channel_name="My Channel",
))
manager.add_channel(user_id=1, channel=UserChannel(
    platform=Platform.VK,
    channel_id="-123456",
    channel_name="–ú–æ—è –≥—Ä—É–ø–ø–∞ –í–ö",
))

# –ö—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥
result = await manager.cross_post(
    user_id=1,
    text="<b>–ù–æ–≤—ã–π –ø–æ—Å—Ç!</b>",  # HTML –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ—Ç—Å—è –¥–ª—è VK
    platforms=[Platform.TELEGRAM, Platform.VK],
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç
if result.all_success:
    print("Posted everywhere!")
elif result.partial_success:
    print(f"OK: {result.successful}, Failed: {result.failed}")
```

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

Manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:
- **Telegram:** HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`<b>`, `<i>`)
- **VK:** –£–±–∏—Ä–∞–µ—Ç HTML (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- **–î–ª–∏–Ω–∞:** –û–±—Ä–µ–∑–∞–µ—Ç –¥–æ –ª–∏–º–∏—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

## API Layer ‚Äî REST –¥–ª—è Mini App –∏ Web

```
app/api/
‚îú‚îÄ‚îÄ __init__.py     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è endpoints
‚îú‚îÄ‚îÄ app.py          # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ models.py       # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ deps.py         # Dependencies (DB, auth, services)
‚îú‚îÄ‚îÄ posts.py        # CRUD –ø–æ—Å—Ç–æ–≤ + AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ calendar.py     # –ö–∞–ª–µ–Ω–¥–∞—Ä—å
```

### –ó–∞–ø—É—Å–∫ API

```bash
# Development
python -m app.api.app
# –∏–ª–∏
uvicorn app.api.app:app --reload --port 8000
```

### Endpoints

```
GET  /health                    - Health check
GET  /api                       - API info

# Posts
POST   /api/posts               - –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
GET    /api/posts               - –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã: status, platform, from_date, to_date)
GET    /api/posts/{id}          - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç
PATCH  /api/posts/{id}          - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å—Ç
DELETE /api/posts/{id}          - –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
POST   /api/posts/{id}/publish  - –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å

# AI
POST   /api/posts/generate      - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
POST   /api/posts/edit          - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å AI

# Calendar
GET    /api/calendar            - –ü–æ—Å—Ç—ã –∑–∞ –ø–µ—Ä–∏–æ–¥ (?days=7 –∏–ª–∏ ?start_date=&end_date=)
GET    /api/calendar/week       - –ù–µ–¥–µ–ª—è (?offset=0)
GET    /api/calendar/month      - –ú–µ—Å—è—Ü (?year=&month=)
GET    /api/calendar/today      - –°–µ–≥–æ–¥–Ω—è
GET    /api/calendar/slots      - –°–ª–æ—Ç—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (?date=YYYY-MM-DD)
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

Telegram Mini App –ø–µ—Ä–µ–¥–∞—ë—Ç `initData` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:
```
X-Telegram-Init-Data: query_id=...&user={"id":123}&auth_date=...&hash=...
```

Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç hash —á–µ—Ä–µ–∑ HMAC —Å bot token.

## Mini App ‚Äî React + Tailwind

```
webapp/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx              # –†–æ—É—Ç–∏–Ω–≥: calendar | editor | post
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Calendar.jsx     # –ù–µ–¥–µ–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostEditor.jsx   # –†–µ–¥–∞–∫—Ç–æ—Ä —Å AI
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTelegram.js   # Telegram WebApp SDK
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ client.js        # API –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ vite.config.js
```

### –ó–∞–ø—É—Å–∫ Mini App

```bash
cd webapp
npm install
npm run dev
# –û—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ http://localhost:5173
# API –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ http://localhost:8000
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É

```python
# –í bot.py –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É
from aiogram.types import WebAppInfo, InlineKeyboardButton

keyboard = InlineKeyboardMarkup(inline_keyboard=[
    [InlineKeyboardButton(
        text="üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å",
        web_app=WebAppInfo(url="https://your-domain.com/")
    )]
])
```

### –§—É–Ω–∫—Ü–∏–∏ Mini App

1. **–ö–∞–ª–µ–Ω–¥–∞—Ä—å** ‚Äî –Ω–µ–¥–µ–ª—è —Å –ø–æ—Å—Ç–∞–º–∏, drag & drop (TODO)
2. **–†–µ–¥–∞–∫—Ç–æ—Ä** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ —Å AI
3. **AI –∫–Ω–æ–ø–∫–∏:**
   - "‚ú® AI" ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–º–µ
   - "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ AI
4. **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã** ‚Äî –≤—ã–±–æ—Ä TG/VK
5. **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ** ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

## SMM Agent ‚Äî –ì–û–¢–û–í (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è)

SMM Agent (`app/smm/`) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —è–¥—Ä–∞:

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç generate_post()

```
Telegram Bot
    ‚Üì
SMMAgent.generate_post(user_id, topic)
    ‚Üì
TaskManager.enqueue() ‚Üí Task #1 (status: queued)
    ‚Üì
Executor.run_task(task)
    ‚Üì
PlanManager.build_plan("smm_generate")
    ‚Üì
Plan: [Step 1] ‚Üí [Step 2] ‚Üí [Step 3] ‚Üí [Step 4]
    ‚Üì
StepExecutor.execute(step) √ó N:
  1. TOOL_CALL memory_search    ‚Äî –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø–æ—Å—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
  2. TOOL_CALL web_search       ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  3. LLM_CALL smm_generate_post ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
  4. APPROVAL                   ‚Äî –ø–∞—É–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚Üì
ApprovalRequired exception ‚Üí Task.status = PAUSED
    ‚Üì
return PostDraft(text=draft_text, task_id=task.id)
    ‚Üì
–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
    ‚Üì
agent.approve_post(task_id) ‚Üí Task.status = SUCCEEDED
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã SMM

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| `app/smm/agent.py` | ~850 | SMMAgent ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Executor |
| `app/smm/bot.py` | ~1100 | Telegram –±–æ—Ç (aiogram) |
| `app/smm/scheduler_tasks.py` | ~270 | –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ |
| `app/executor/plan_manager.py` | ~290 | –®–∞–±–ª–æ–Ω—ã –ø–ª–∞–Ω–æ–≤ smm_generate, smm_analyze |
| `app/executor/step_executor.py` | ~490 | Handlers –¥–ª—è LLM_CALL, TOOL_CALL, APPROVAL |
| `app/tools/smm_tools.py` | ~200 | SMM tools: parse_channel, web_search, memory_search |

### SMMAgent API

```python
agent = SMMAgent(db=db, llm=llm)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (—á–µ—Ä–µ–∑ Executor)
draft = agent.generate_post(user_id, topic, style=None) ‚Üí PostDraft
draft = agent.generate_post_with_research(user_id, topic) ‚Üí PostDraft

# –û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
agent.approve_post(task_id, user_id, post_text)
agent.reject_post(task_id, user_id, reason)

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–æ—Å—Ç–æ–π LLM ‚Äî –±–µ–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
new_text = agent.edit_post(user_id, original, edit_request, topic="")
new_text = agent.edit_post_with_history(user_id, current, edit_request, versions)

# –ü–∞–º—è—Ç—å
agent.save_style(user_id, style)
agent.save_channel(user_id, channel_id, channel_name)
agent.add_competitor(user_id, channel, auto_analyze=True)
agent.save_feedback(user_id, feedback, post_text)
agent.build_smm_context(user_id, extra_style) ‚Üí str

# –ê–Ω–∞–ª–∏–∑
posts, analysis = agent.analyze_single_channel(user_id, channel)
posts, analysis = agent.analyze_competitors(user_id)
raw_news, ideas = agent.fetch_hot_news(user_id)
ideas = agent.propose_ideas(user_id)
report = agent.weekly_report(user_id)
```

### Plan Templates (plan_manager.py)

**smm_generate** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞:
```python
Steps:
1. TOOL_CALL memory_search   ‚Äî –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤ –ø–∞–º—è—Ç–∏
2. TOOL_CALL web_search      ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. LLM_CALL smm_generate_post ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
4. APPROVAL                   ‚Äî –∂–¥—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**smm_edit** ‚Äî –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø (—É–ø—Ä–æ—â–µ–Ω–æ –≤ v6):
```
–°–µ–π—á–∞—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø—Ä–æ—Å—Ç–æ–π LLM –≤—ã–∑–æ–≤ –≤ agent.edit_post():
1. LLM —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç + –∑–∞–ø—Ä–æ—Å
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ [{action, text}]
3. –ö–û–î –ø—Ä–∏–º–µ–Ω—è–µ—Ç
```

**smm_analyze** ‚Äî –∞–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–∞:
```python
Steps:
1. TOOL_CALL parse_channel   ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤
2. LLM_CALL smm_analyze_style ‚Äî –∞–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è
3. TOOL_CALL memory_store    ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

### SMM Tools (smm_tools.py)

```python
register_smm_tools(channel_parser, news_monitor, memory_service, llm_service)

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ tools:
- parse_channel(channel, limit, top) ‚Üí {posts: [...]}
- web_search(query, limit) ‚Üí {results: [...]}
- fetch_news(limit_per_source) ‚Üí {news: [...]}
- memory_search(user_id, query, limit) ‚Üí {results: [...]}
- memory_store(user_id, content, memory_type, importance) ‚Üí {success: bool}
- parse_edit_intent(edit_request, original_text) ‚Üí {operations: [...]}
- apply_edit_operations(original_text, operations, generated) ‚Üí {result: str}
```

### –ë–æ—Ç: Telegram –∫–æ–º–∞–Ω–¥—ã

```
/start      - –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (–∫–∞–Ω–∞–ª ‚Üí –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã ‚Üí —Å—Ç–∏–ª—å)
/post       - –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
/channel    - –°–º–µ–Ω–∏—Ç—å –∫–∞–Ω–∞–ª
/competitor - –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
/competitors - –°–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
/analyze    - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
/news       - –ì–æ—Ä—è—á–∏–µ —Ç–µ–º—ã –∏–∑ –∑–∞–ø–∞–¥–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
/ideas      - –ò–¥–µ–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤
/research   - –ü–æ—Å—Ç —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º —Ç–µ–º—ã
/source     - –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
/sources    - –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
/drafts     - –ß–µ—Ä–Ω–æ–≤–∏–∫–∏
/report     - –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
/style      - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å
```

### –ë–æ—Ç: –ú–µ–Ω—é

```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:
‚îú‚îÄ‚îÄ üé§ –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç
‚îú‚îÄ‚îÄ üí° –ò–¥–µ–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
‚îú‚îÄ‚îÄ üìã –ß–µ—Ä–Ω–æ–≤–∏–∫–∏
‚îî‚îÄ‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    ‚îú‚îÄ‚îÄ üì∫ –°–º–µ–Ω–∏—Ç—å –∫–∞–Ω–∞–ª
    ‚îú‚îÄ‚îÄ üë• –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ üì∞ –ò—Å—Ç–æ—á–Ω–∏–∫–∏
    ‚îú‚îÄ‚îÄ üé® –°—Ç–∏–ª—å
    ‚îî‚îÄ‚îÄ üîô –ù–∞–∑–∞–¥
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
yadro-smm/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/            # FastAPI REST API
‚îÇ   ‚îú‚îÄ‚îÄ config/         # Settings, –∫–æ–Ω—Ñ–∏–≥–∏ –ª–∏–º–∏—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ executor/       # Plan, Step, ExecutionContext, StepExecutor
‚îÇ   ‚îú‚îÄ‚îÄ interfaces/     # TelegramBotHandler, rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ kernel/         # TaskManager, Task state machine
‚îÇ   ‚îú‚îÄ‚îÄ llm/            # LLMService, ModelRouter, CostTracker
‚îÇ   ‚îú‚îÄ‚îÄ memory/         # MemoryService, FTS5 search
‚îÇ   ‚îú‚îÄ‚îÄ providers/      # –°–æ—Ü—Å–µ—Ç–∏: Telegram, VK
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/      # Scheduler, cron
‚îÇ   ‚îú‚îÄ‚îÄ smm/            # SMM Agent, Bot, Scheduler Tasks
‚îÇ   ‚îú‚îÄ‚îÄ storage/        # Database (SQLite WAL), FileStorage
‚îÇ   ‚îî‚îÄ‚îÄ tools/          # BrowserTool, ToolRegistry, SMM tools
‚îú‚îÄ‚îÄ webapp/             # Telegram Mini App (React)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/ # Calendar, PostEditor
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/      # useTelegram
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/        # API client
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ data/               # –ë–î, uploads, outputs, snapshots
‚îú‚îÄ‚îÄ tests/              # Pytest —Ç–µ—Å—Ç—ã (301 —Ç–µ—Å—Ç–æ–≤)
‚îî‚îÄ‚îÄ venv/
```

## –ö–æ–º–∞–Ω–¥—ã

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è
source venv/bin/activate

# –¢–µ—Å—Ç—ã
pytest tests/ -q --ignore=tests/test_browser.py
pytest tests/test_executor.py -v
pytest tests/test_kernel.py -v

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–¥–µ–ª–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
python -m app.smm.bot

# –ü—Ä–∏–º–µ—Ä—ã
python examples/demo_full.py      # –î–µ–º–æ –≤—Å–µ—Ö —Å–ª–æ—ë–≤
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```bash
TELEGRAM_BOT_TOKEN=...
TELEGRAM_BOT_USERNAME=@...
OPENAI_API_KEY=sk-...
APP_ENV=development
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã

### Storage (Layer 0)
```python
Database(path)              # SQLite, WAL mode, thread-safe
  .execute(sql, params)     # INSERT/UPDATE/DELETE
  .fetch_one/all/value()    # SELECT
  .transaction()            # Context manager

FileStorage(base_path)      # –§–∞–π–ª—ã: uploads, outputs, snapshots
```

### Kernel (Layer 2) - Task State Machine
```python
TaskManager(db)
  .enqueue(user_id, task_type, input_text, input_data) ‚Üí Task
  .claim(worker_id) ‚Üí Task          # –ê—Ç–æ–º–∞—Ä–Ω—ã–π –∑–∞—Ö–≤–∞—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏
  .heartbeat(task_id, worker_id)    # –ü—Ä–æ–¥–ª–µ–Ω–∏–µ lease
  .pause(task_id, reason, data)     # APPROVAL | DEPENDENCY | RATE_LIMIT
  .resume(task_id)
  .succeed(task_id, result)
  .fail(task_id, error)             # –° retry –ª–æ–≥–∏–∫–æ–π
  .cancel(task_id)

# –°–æ—Å—Ç–æ—è–Ω–∏—è: created ‚Üí queued ‚Üí running ‚Üí paused/succeeded/failed/cancelled
```

### Executor (Layer 3)
```python
Executor(db, task_manager, step_executor)
  .run_task(task)                   # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Plan/Step
  .handle_approval(task_id, approved, edited_content)

PlanManager()
  .build_plan(task_id, task_type, input_text, input_data) ‚Üí Plan

StepExecutor(task_manager, llm_service)
  .execute(step, context) ‚Üí result
  # Handlers: _handle_llm_call, _handle_tool_call, _handle_approval

Plan(task_id, steps)
  .get_next_step() ‚Üí Step           # –£—á–∏—Ç—ã–≤–∞–µ—Ç depends_on
  .is_complete ‚Üí bool

Step(action, action_data, depends_on)
  # Actions: LLM_CALL, TOOL_CALL, APPROVAL, CONDITION, AGGREGATE

ExecutionContext(task_id, user_id, plan)
  .step_results: Dict[str, Any]
  .add_step_result(step_id, result)
  .get_step_result(step_id) ‚Üí Any
```

### LLM (Layer 5)
```python
LLMService(db, mock_mode, anthropic_api_key, openai_api_key)
  .complete(messages, model, user_id, task_id, temperature) ‚Üí LLMResponse
  .complete_simple(prompt, system_prompt, temperature) ‚Üí str

Message.system(content)
Message.user(content)
Message.assistant(content)

LLMResponse:
  .content: str
  .model: str
  .total_tokens: int
  .cost_usd: float

# –ú–æ–¥–µ–ª–∏: claude-sonnet-4-20250514 (–æ—Å–Ω–æ–≤–Ω–∞—è), gpt-4o (fallback), mock
```

### Memory (Layer 6)
```python
MemoryService(db)
  .store(user_id, content, memory_type, importance) ‚Üí MemoryItem
  .store_fact(user_id, content)
  .store_decision(user_id, content, source_task_id)
  .search(user_id, query, limit) ‚Üí List[SearchResult]  # FTS5
  .build_context(user_id, query) ‚Üí MemoryContext
  .get_facts(user_id) ‚Üí List[MemoryItem]

# –¢–∏–ø—ã: FACT, DECISION, CONTEXT, TASK, FEEDBACK
```

### Tools (Layer 4)
```python
ToolRegistry()
  .register(name, handler, impact, allowed_task_types, parameters)
  .get(name) ‚Üí ToolSpec
  .list_for_task_type(task_type) ‚Üí List[ToolSpec]

# SMM Tools (—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞):
register_smm_tools(channel_parser, news_monitor, memory_service, llm_service)

ChannelParser()
  .get_top_posts(channel, limit) ‚Üí List[ChannelPost]
  .get_recent_posts(channel, limit) ‚Üí List[ChannelPost]

NewsMonitor()
  .fetch_all(limit_per_source) ‚Üí List[NewsItem]
  .fetch_custom_rss(url, name, limit) ‚Üí List[NewsItem]
  .search_duckduckgo(query, limit) ‚Üí List[NewsItem]
```

## –°—Ö–µ–º–∞ –ë–î

```sql
users (id, tg_id, username, settings JSON)
tasks (id, user_id, task_type, status, input_text, input_data, result, error, current_plan_id, current_step_id)
task_events (id, task_id, event_type, event_data JSON, step_id)
task_steps (id, task_id, plan_id, step_id, step_index, action, action_data, status, result, error)
schedules (id, user_id, task_spec JSON, cron, next_run_at)
memory_items (id, user_id, memory_type, content, importance, metadata)
memory_fts (content)  -- FTS5 virtual table
costs (id, user_id, task_id, model, input_tokens, output_tokens, cost_usd)
drafts (id, user_id, text, topic, channel_id, publish_at, status)
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã

- **State Machine** ‚Äî Task: created‚Üíqueued‚Üírunning‚Üí{paused,succeeded,failed}
- **Distributed Locking** ‚Äî lease_expires_at –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- **Dependency DAG** ‚Äî Step.depends_on –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Fallback Chain** ‚Äî gpt-4o ‚Üí gpt-4o-mini ‚Üí mock
- **FTS5 Search** ‚Äî –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏
- **Cost Tracking** ‚Äî –í—Å–µ LLM –≤—ã–∑–æ–≤—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Ü–µ–Ω–æ–π
- **ApprovalRequired** ‚Äî Exception –¥–ª—è –ø–∞—É–∑—ã –Ω–∞ approval

## –õ–∏–º–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# TaskManager
max_queued_per_user: 10
max_active_per_user: 3
max_tasks_per_hour: 50

# LLMService
max_requests_per_minute: 10
max_requests_per_hour: 100
max_cost_per_request: $0.50
max_cost_per_hour: $5.00
max_cost_per_day: $20.00

# Executor
max_steps: 20
max_wall_time_seconds: 300

# ToolRuntime
timeout_seconds: 60
requires_approval: bool
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `aiogram` ‚Äî Telegram bot framework
- `anthropic` ‚Äî Claude API (–æ—Å–Ω–æ–≤–Ω–∞—è LLM)
- `openai` ‚Äî OpenAI API (fallback)
- `playwright` ‚Äî –ë—Ä–∞—É–∑–µ—Ä
- `pydantic` ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è
- `pytest` ‚Äî –¢–µ—Å—Ç—ã
- `requests`, `beautifulsoup4` ‚Äî HTTP, –ø–∞—Ä—Å–∏–Ω–≥
- Python 3.13+

## –ü–∞–º—è—Ç—å SMM Agent

–§–æ—Ä–º–∞—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ memory_items:

```
–°—Ç–∏–ª—å: {–æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏–ª—è}
–ö–∞–Ω–∞–ª: {name} (ID: {id})
–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç: {channel}
–ò—Å—Ç–æ—á–Ω–∏–∫: {name} | {url}
–£–¥–∞—á–Ω—ã–π –ø–æ—Å—Ç: {text} | –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {count}
–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç: {text}
–°—Ç–∏–ª—å –∫–∞–Ω–∞–ª–∞ {name}: {analysis}
–ê–Ω–∞–ª–∏–∑ {channel}: {analysis}
–§–∏–¥–±–µ–∫: {feedback} | –ü–æ—Å—Ç: {example}
–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∫–∏: '{request}' | –ë—ã–ª–æ: ... | –°—Ç–∞–ª–æ: ...
–¢—Ä–µ–Ω–¥: {description}
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞

### –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –ê–≥–µ–Ω—Ç + –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

**–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –ø–æ–∫–∞–∑–∞–ª:**
- 78% –ø–æ–∫—É–ø–∞—é—Ç SMM-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–¥–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤
- 23% —Ä–∞–¥–∏ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ß–∏—Å—Ç—ã–µ AI-–ø–∏—Å–∞—Ç–µ–ª–∏ (Jasper, Copy.ai) —É–º–∏—Ä–∞—é—Ç ‚Äî ChatGPT –±–µ—Å–ø–ª–∞—Ç–µ–Ω
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ —Å AI (Buffer, Later, Postiz) ‚Äî –∂–∏–≤—É—Ç

**–ü–æ—á–µ–º—É Jasper —É–º–∏—Ä–∞–µ—Ç, –∞ Buffer –∂–∏–≤—ë—Ç:**
```
Jasper: "–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç" ‚Üí GPT ‚Üí —Ç–µ–∫—Å—Ç
        –ö–æ–Ω–∫—É—Ä–∏—Ä—É–µ—Ç —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º ChatGPT
        –ù–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏, –ª–µ–≥–∫–æ —É–π—Ç–∏

Buffer: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ + –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ + (AI –∫–∞–∫ —Ñ–∏—á–∞)
        ChatGPT –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—ã
        –í—Å–µ –ø–æ—Å—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ = switching cost
```

**–ù–∞—à–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ ChatGPT:**
- –ü–æ–º–Ω–∏–º —Å—Ç–∏–ª—å –∫–∞–Ω–∞–ª–∞
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- –£—á–∏–º—Å—è –Ω–∞ —Ñ–∏–¥–±–µ–∫–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è

### –î–≤–∞ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ   –†–ï–ñ–ò–ú 1: –ê–ì–ï–ù–¢ (–±—ã—Å—Ç—Ä–æ, –Ω–∞ —Ö–æ–¥—É)                              ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                              ‚îÇ
‚îÇ   –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: Telegram –±–æ—Ç / –≥–æ–ª–æ—Å                               ‚îÇ
‚îÇ   –°—Ü–µ–Ω–∞—Ä–∏–π: "–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç –ø—Ä–æ –Ω–æ–≤—É—é –∞–∫—Ü–∏—é"                       ‚îÇ
‚îÇ   –†–µ–∑—É–ª—å—Ç–∞—Ç: –ê–≥–µ–Ω—Ç –ø–∏—à–µ—Ç –≤ —Ç–≤–æ—ë–º —Å—Ç–∏–ª–µ –∑–∞ 10 —Å–µ–∫                ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   –ö–æ–≥–¥–∞: –í –º–µ—Ç—Ä–æ, –º–µ–∂–¥—É –≤—Å—Ç—Ä–µ—á–∞–º–∏, –∏–¥–µ—è –ø—Ä–∏—à–ª–∞                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ   –†–ï–ñ–ò–ú 2: –ü–õ–ê–ù–ò–†–û–í–©–ò–ö (—Å–µ—Å—Ç—å –∏ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å)                   ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                    ‚îÇ
‚îÇ   –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: Mini App ‚Üí –ø–æ—Ç–æ–º –≤–µ–±                               ‚îÇ
‚îÇ   –°—Ü–µ–Ω–∞—Ä–∏–π: –ö–∞–ª–µ–Ω–¥–∞—Ä—å, drag & drop, –ø—Ä–µ–≤—å—é                      ‚îÇ
‚îÇ   AI: –ö–Ω–æ–ø–∫–∞ "–ü–æ–º–æ–≥–∏ –Ω–∞–ø–∏—Å–∞—Ç—å" –∫–æ–≥–¥–∞ –∑–∞—Å—Ç—Ä—è–ª                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   –ö–æ–≥–¥–∞: –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤–µ—á–µ—Ä–æ–º, –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –Ω–µ–¥–µ–ª—é                 ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

**–°–µ–π—á–∞—Å (MVP):**
- Solo-–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ —Å Telegram-–∫–∞–Ω–∞–ª–∞–º–∏
- –≠–∫—Å–ø–µ—Ä—Ç—ã (–∫–æ—É—á–∏, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã)
- –ù–µ–±–æ–ª—å—à–∏–µ –±—Ä–µ–Ω–¥—ã –≤ –†–æ—Å—Å–∏–∏/–°–ù–ì

**–ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ–º:**
> "–•–æ—á—É –≤–µ—Å—Ç–∏ –∫–∞–Ω–∞–ª, –Ω–æ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
> –•–æ—á—É —á—Ç–æ–±—ã –ø–æ—Å—Ç—ã –∑–≤—É—á–∞–ª–∏ –∫–∞–∫ —è, –∞ –Ω–µ –∫–∞–∫ ChatGPT."

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ü–æ—á–µ–º—É Mini App –ø–µ—Ä–≤—ã–º:**
```
Mini App = –æ–±—ã—á–Ω—ã–π –≤–µ–± (React), –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Telegram
         ‚Üì
–ü–ª—é—Å—ã:
‚Ä¢ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ (Telegram –ø–µ—Ä–µ–¥–∞—ë—Ç user_id)
‚Ä¢ –ù–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ Telegram
         ‚Üì
–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤–µ–± = –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
–û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π
```

**–ß—Ç–æ –±–µ—Ä—ë–º –æ—Ç Postiz:**
- ‚úÖ UI/UX –∏–¥–µ–∏ (–∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –ø—Ä–µ–≤—å—é)
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (providers, structured output)
- ‚ùå –ö–æ–¥ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (—Å–ª–∏—à–∫–æ–º —Å–≤—è–∑–∞–Ω —Å –∏—Ö –±—ç–∫–µ–Ω–¥–æ–º)
- ‚ùå LangGraph/Mastra (—É –Ω–∞—Å —Å–≤–æ–∏ Plan/Steps)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Telegram Bot ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Mini App / Web
      ‚îÇ                                     ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –û–±—â–∏–π Backend ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ              ‚îÇ              ‚îÇ
    SMMAgent       Providers       Memory
    (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)    (TG, VK)       (—Å—Ç–∏–ª—å)
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —è–¥—Ä–∞

**–ü—Ä–∏–Ω—Ü–∏–ø:** –Ø–¥—Ä–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ, SMM ‚Äî –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ.

```
–°–µ–π—á–∞—Å:                          –ü–æ—Ç–æ–º:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Memory      ‚Üí —Å—Ç–∏–ª—å –∫–∞–Ω–∞–ª–∞       ‚Üí –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞
Providers   ‚Üí Telegram, VK       ‚Üí email, SMS, CRM
Executor    ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤   ‚Üí –ª—é–±—ã–µ –∑–∞–¥–∞—á–∏
Plan/Steps  ‚Üí SMM workflow       ‚Üí –ª–æ–≥–∏—Å—Ç–∏–∫–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞
```

**–ù–µ –ø–æ–≥—Ä—è–∑–Ω—É—Ç—å –≤ SMM:**
- –î–µ—Ä–∂–∞—Ç—å —Å–ª–æ–∏ —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–º–∏
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ SMM —Ç–æ–ª—å–∫–æ –≤ `app/smm/`
- –Ø–¥—Ä–æ (`kernel`, `executor`, `memory`, `providers`) ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2026-01-28: Claude Sonnet 4 + –ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **Claude Sonnet 4 –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è LLM** (`claude-sonnet-4-20250514`)
   - –ó–∞–º–µ–Ω–∏–ª GPT-4o –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤
   - –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏ —Å—Ç–∏–ª—å

2. **–ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ –∫–∞–Ω–∞–ª–∞**
   ```python
   # smm_tools.py ‚Üí compute_channel_metrics()
   # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç content_type –∏ recommended_temperature:
   - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π (–¥–ª–∏–Ω–Ω—ã–µ + –º–∞–ª–æ —ç–º–æ–¥–∑–∏) ‚Üí 0.3
   - –Ω–æ–≤–æ—Å—Ç–Ω–æ–π (–±–µ–∑ —ç–º–æ–¥–∑–∏ + –±–µ–∑ CTA) ‚Üí 0.35
   - —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π (default) ‚Üí 0.5
   - –∞–≤—Ç–æ—Ä—Å–∫–∏–π (–º–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏ + CTA) ‚Üí 0.6
   - –ª–∞–π—Ñ—Å—Ç–∞–π–ª (–∫–æ—Ä–æ—Ç–∫–∏–µ + —ç–º–æ–¥–∑–∏) ‚Üí 0.7
   ```

3. **–ò–Ω—Å–∞–π—Ç—ã –≤–º–µ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∏–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤**
   ```python
   # agent.py ‚Üí _extract_competitor_insights()
   # –û–°–¢–ê–í–õ–Ø–ï–ú: —Ç–µ–º—ã, —Ö—É–∫–∏, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
   # –£–ë–ò–†–ê–ï–ú: –ª–∏—Ü–æ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —ç–º–æ–¥–∑–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

   # –í –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
   "–ò–ù–°–ê–ô–¢–´ (—Ç–µ–º—ã –∏ –∏–¥–µ–∏, –ù–ï —Å—Ç–∏–ª—å!):\n..."
   "‚ö†Ô∏è –ü–∏—à–∏ –≤ –°–í–û–Å–ú —Å—Ç–∏–ª–µ, –Ω–µ –∫–æ–ø–∏—Ä—É–π @channel!"
   ```

4. **–î–µ—Ñ–æ–ª—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤**
   ```python
   # step_executor.py ‚Üí _apply_style_postprocess()
   # –ï—Å–ª–∏ –Ω–µ—Ç —Å–≤–æ–µ–≥–æ —Å—Ç–∏–ª—è:
   - –ñ–∏—Ä–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ < 100 —Å–∏–º–≤–æ–ª–æ–≤)
   - –≠–º–æ–¥–∑–∏ –ø–æ —Ç–µ–º–µ (üí∞ —Ñ–∏–Ω–∞–Ω—Å—ã, ü§ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, üí™ –∑–¥–æ—Ä–æ–≤—å–µ...)
   ```

5. **–û—Ç–∫–∞—Ç –≤–µ—Ä—Å–∏–π** ‚Äî –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —á–µ—Ä–µ–∑ callback

6. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–æ–º–∞–Ω–¥**
   ```python
   # "–∫–æ—Ä–æ—á–µ" ‚Üí "—Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—á–µ"
   # "–∂–∏—Ä–Ω–µ–µ" ‚Üí "–≤—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã –∂–∏—Ä–Ω—ã–º"
   ```

**–°–µ—Ä–≤–µ—Ä:**
- AWS EC2 (micro)
- IP: 35.156.188.57 (Elastic IP ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π)
- User: ubuntu
- Path: /home/ubuntu/yadro-smm
- Systemd: yadro-bot.service
- SSH: `ssh -i ~/Desktop/yadro-key.pem ubuntu@35.156.188.57`

**–î–µ–ø–ª–æ–π:**
```bash
./deploy.sh  # rsync + systemctl restart yadro-bot
```

---

### 2025-01-26 (v9): API Layer + Mini App

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å REST API –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø–æ—Å—Ç–æ–≤.

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

Backend (FastAPI):
```
app/api/
‚îú‚îÄ‚îÄ app.py          # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ models.py       # Pydantic –º–æ–¥–µ–ª–∏ (PostCreate, CalendarResponse, etc.)
‚îú‚îÄ‚îÄ deps.py         # Telegram Mini App auth, dependencies
‚îú‚îÄ‚îÄ posts.py        # CRUD + publish + AI generate/edit
‚îî‚îÄ‚îÄ calendar.py     # Week/month/slots endpoints
```

Frontend (React + Tailwind):
```
webapp/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx              # –†–æ—É—Ç–∏–Ω–≥ views
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Calendar.jsx     # –ù–µ–¥–µ–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostEditor.jsx   # –†–µ–¥–∞–∫—Ç–æ—Ä —Å AI
‚îÇ   ‚îú‚îÄ‚îÄ hooks/useTelegram.js # WebApp SDK
‚îÇ   ‚îî‚îÄ‚îÄ api/client.js        # API –∫–ª–∏–µ–Ω—Ç
‚îî‚îÄ‚îÄ package.json
```

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏:**
- Telegram Mini App –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (HMAC –≤–∞–ª–∏–¥–∞—Ü–∏—è initData)
- CRUD –ø–æ—Å—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü/—Å–ª–æ—Ç—ã)
- AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API
- –ú—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (TG + VK selection)
- Tailwind —Å Telegram theme colors

**–¢–µ—Å—Ç—ã:** 14 –Ω–æ–≤—ã—Ö API —Ç–µ—Å—Ç–æ–≤ (–≤—Å–µ–≥–æ 301)

**–§–∞–π–ª—ã:** `app/api/*`, `webapp/*`, `tests/test_api.py`

---

### 2025-01-26 (v8): Provider Architecture ‚Äî –º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –ø–æ—Å—Ç–∏–Ω–≥

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥—É –≤ VK –∏ Instagram (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç Postiz).

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

```
app/providers/
‚îú‚îÄ‚îÄ __init__.py      # –≠–∫—Å–ø–æ—Ä—Ç—ã
‚îú‚îÄ‚îÄ base.py          # SocialProvider (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å)
‚îú‚îÄ‚îÄ telegram.py      # TelegramProvider (Bot API)
‚îú‚îÄ‚îÄ vk.py            # VKProvider (VK API + OAuth2 + PKCE)
‚îî‚îÄ‚îÄ manager.py       # ProviderManager (–∫—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥)
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**
- `SocialProvider` ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ `post()`, `validate_channel()`, `delete_post()`, `edit_post()`
- `TelegramProvider` ‚Äî –ø–æ—Å—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ Bot API, HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `VKProvider` ‚Äî OAuth2 + PKCE, –∑–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞ VK, wall.post
- `ProviderManager` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∫—Ä–æ—Å—Å-–ø–æ—Å—Ç–∏–Ω–≥–∞, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- `PostResult`, `MediaItem`, `CrossPostResult` ‚Äî data classes

**VK OAuth2 flow:**
```
1. get_auth_url() ‚Üí OAuth URL —Å PKCE challenge
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è
3. exchange_code() ‚Üí access_token
4. post() ‚Üí wall.post —Å attachments
```

**–¢–µ—Å—Ç—ã:** 32 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞ (–≤—Å–µ–≥–æ 287)

**–§–∞–π–ª—ã:** `app/providers/base.py`, `app/providers/telegram.py`, `app/providers/vk.py`, `app/providers/manager.py`, `tests/test_providers.py`

---

### 2025-01-26 (v7): –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (precise + creative)

**–ü—Ä–æ–±–ª–µ–º–∞ v6:** LLM –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–∏ JSON, –Ω–æ –Ω–µ –ø–æ–Ω–∏–º–∞–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—Ä–æ–¥–µ "–¥–æ–±–∞–≤—å –∞–±–∑–∞—Ü –º–µ–∂–¥—É 2 –∏ 3" –∏–ª–∏ "—Å–¥–µ–ª–∞–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–ª–∞–≤–Ω–µ–µ".

**–†–µ—à–µ–Ω–∏–µ: –î–≤–∞ —Ä–µ–∂–∏–º–∞**

```
edit_post(original, request)
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ _split_edit_request() ‚Üí ["—É–±–µ—Ä–∏ –∞–±–∑–∞—Ü", "–¥–æ–±–∞–≤—å —Ö—É–∫"]
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ _is_precise_edit() ‚Üí –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏
    ‚îÇ       - "—É–±–µ—Ä–∏ –∞–±–∑–∞—Ü" ‚Üí precise (regex)
    ‚îÇ       - "–¥–æ–±–∞–≤—å —Ö—É–∫" ‚Üí creative (LLM)
    ‚îÇ
    ‚îú‚îÄ‚ñ∫ –°–Ω–∞—á–∞–ª–∞ –í–°–ï precise –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫–æ–¥, –±–µ–∑ LLM):
    ‚îÇ       _precise_edit() ‚Üí —É–¥–∞–ª—è–µ—Ç –∞–±–∑–∞—Ü
    ‚îÇ
    ‚îî‚îÄ‚ñ∫ –ü–æ—Ç–æ–º creative (LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç):
            _creative_edit() ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç —Ö—É–∫
```

**Precise —Ä–µ–∂–∏–º** (–∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç):
- –£–±—Ä–∞—Ç—å —ç–º–æ–¥–∑–∏ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–ª–∏ –≤—Å–µ)
- –£–¥–∞–ª–∏—Ç—å –∞–±–∑–∞—Ü –ø–æ –Ω–æ–º–µ—Ä—É (–ø–µ—Ä–≤—ã–π, –ø–æ—Å–ª–µ–¥–Ω–∏–π, N-—ã–π)
- –í—ã–¥–µ–ª–∏—Ç—å –∂–∏—Ä–Ω—ã–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
- –£–±—Ä–∞—Ç—å —Ö—ç—à—Ç–µ–≥–∏
- –ó–∞–º–µ–Ω–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ç–µ–∫—Å—Ç

**Creative —Ä–µ–∂–∏–º** (LLM –≤–∏–¥–∏—Ç –≤—Å—ë):
- –î–æ–±–∞–≤–∏—Ç—å –∞–±–∑–∞—Ü –º–µ–∂–¥—É X –∏ Y
- –î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫/–∑–∞—Ü–µ–ø–∫—É
- –°–¥–µ–ª–∞—Ç—å –∫–æ—Ä–æ—á–µ/–¥–ª–∏–Ω–Ω–µ–µ
- –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º —Å—Ç–∏–ª–µ
- –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –ø–ª–∞–≤–Ω–µ–µ

**–£–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –≤ creative —Ä–µ–∂–∏–º–µ:**
- "–¥–æ–±–∞–≤—å/–¥–æ–ø–æ–ª–Ω–∏/—Ä–∞—Å—à–∏—Ä—å" ‚Üí —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –¥–æ 5x –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
- "—Å–æ–∫—Ä–∞—Ç–∏/–∫–æ—Ä–æ—á–µ/—É–±–µ—Ä–∏/—É–¥–∞–ª–∏" ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä–æ—á–µ (max 1.2x)
- –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí –¥–æ 3x –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `agent.py`:
  - `edit_post()` ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä
  - `_split_edit_request()` ‚Äî —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —á–∞—Å—Ç–∏ (–∑–∞—â–∏—â–∞–µ—Ç "N –∏ M")
  - `_is_precise_edit()` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã (+ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞)
  - `_precise_edit()` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ—á–µ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–º
  - `_creative_edit()` ‚Äî LLM –≤–∏–¥–∏—Ç –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–±–∑–∞—Ü—ã, —É–º–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞:**
- "—á—ë—Ä–Ω—ã–º/—á—ë—Ä–Ω—ã–π" ‚Üí "–∂–∏—Ä–Ω—ã–º" (–≥–æ–ª–æ—Å –ø—É—Ç–∞–µ—Ç)
- "—Å–º–∞–π–ª–∏–∫/—Å–º–∞–π–ª–∏–∫–∏" ‚Üí "—ç–º–æ–¥–∑–∏"
- "—É–±–µ—Ä–∏ —Ä–∞–¥—É–≥—É" ‚Üí —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –∫–∞–∫ —ç–º–æ–¥–∑–∏ –±–µ–∑ —Å–ª–æ–≤–∞ "—ç–º–æ–¥–∑–∏"

**–ü—Ä–∏–º–µ—Ä—ã:**
```
"—É–±–µ—Ä–∏ —ç–º–æ–¥–∑–∏ üåà" ‚Üí precise
"—É–±–µ—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–±–∑–∞—Ü –∏ –¥–æ–±–∞–≤—å —Ö—É–∫" ‚Üí precise + creative
"–¥–æ–±–∞–≤—å –∞–±–∑–∞—Ü –ø—Ä–æ –∫–∞—á–µ—Å—Ç–≤–æ –º–µ–∂–¥—É 2 –∏ 3" ‚Üí creative (—á–∏—Å–ª–∞ –∑–∞—â–∏—â–µ–Ω—ã)
"—Å–¥–µ–ª–∞–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–ª–∞–≤–Ω–µ–µ" ‚Üí creative
```

**–§–∞–π–ª—ã:** `app/smm/agent.py`

---

### 2025-01-26 (v6): –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è + –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞ v5:** –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–ø–∞—Ä—Å–∏–Ω–≥ + LLM –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è + –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è) —Ä–∞–±–æ—Ç–∞–ª –ø–ª–æ—Ö–æ ‚Äî —É–¥–∞–ª—è–ª –ª–∏—à–Ω–∏–µ –∞–±–∑–∞—Ü—ã, –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª —Ç–µ–∫—Å—Ç.

**–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ—Å—Ç–æ–π LLM-–ø–æ–¥—Ö–æ–¥**

```
–ó–∞–ø—Ä–æ—Å: "—É–±–µ—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–±–∑–∞—Ü –∏ —ç–º–æ–¥–∑–∏ üîß"
    ‚Üì
LLM —á–∏—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç + –∑–∞–ø—Ä–æ—Å
    ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¢–û–ß–ù–´–ú —Ç–µ–∫—Å—Ç–æ–º:
[
  {"action": "delete", "text": "üîß"},
  {"action": "delete", "text": "–í–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–±–∑–∞—Ü–∞..."}
]
    ‚Üì
–ö–û–î –ø—Ä–∏–º–µ–Ω—è–µ—Ç (—Å fuzzy whitespace matching)
```

**–†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
–ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç —Å –∂–∏—Ä–Ω—ã–º
    ‚Üì
–ö–æ–ø–∏—Ä—É–µ—Ç, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—è–µ—Ç—Å—è)
    ‚Üì
LLM –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç <b> –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
    ‚Üì
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å–ª–∞–ª —Å <b> –∏–ª–∏ ** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `agent.py`:
  - `edit_post()` ‚Äî —É–ø—Ä–æ—â—ë–Ω, –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - `_analyze_edit_request()` ‚Äî LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–æ—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
  - `_apply_operation()` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç delete/replace/insert
  - –£–±—Ä–∞–Ω—ã: `_parse_edit_intent`, `_classify_intent_with_llm`, `_verify_edit`
- `bot.py`:
  - `_restore_formatting()` ‚Äî LLM –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∂–∏—Ä–Ω—ã–π –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
  - `_markdown_to_html()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `**` ‚Üí `<b>`
  - –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- `step_executor.py`:
  - `_markdown_to_html()` ‚Äî –æ—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–µ–π `<b><b>` ‚Üí `<b>`

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
| –§—É–Ω–∫—Ü–∏—è | –ü–æ–¥—Ö–æ–¥ | Memory | Web | Plan/Steps |
|---------|--------|--------|-----|------------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ê–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–∞ | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚úÖ | ‚ùå | ‚úÖ |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü—Ä–æ—Å—Ç–æ–π LLM | ‚ùå | ‚ùå | ‚ùå |
| –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä. | LLM —Ñ–æ—Ä–º–∞—Ç | ‚ùå | ‚ùå | ‚ùå |

**–§–∞–π–ª—ã:** `app/smm/agent.py`, `app/smm/bot.py`, `app/executor/step_executor.py`

---

### 2025-01-26 (v5): –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è + –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—É—Å—Ç–∞—Ä–µ–ª–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ LLM "—Ç—É–ø–µ–ª" ‚Äî –Ω–µ –ø–æ–Ω–∏–º–∞–ª –∫–æ–º–∞–Ω–¥—ã, –¥–æ–±–∞–≤–ª—è–ª —Ö—É–∫ –≤ –∫–æ–Ω–µ—Ü –≤–º–µ—Å—Ç–æ –Ω–∞—á–∞–ª–∞, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª –≤—Å–µ –ø—Ä–æ—Å—å–±—ã.

**–†–µ—à–µ–Ω–∏–µ: –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```
–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞: "–¥–æ–±–∞–≤—å —Ö—É–∫ –∏ —É–±–µ—Ä–∏ —Ö—ç—à—Ç–µ–≥–∏"
    ‚Üì
1. CODE –ø–∞—Ä—Å–∏—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (regex)
   ‚Üí –Ω–∞–π–¥–µ–Ω–æ: delete_hashtags
   ‚Üí –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: "–¥–æ–±–∞–≤—å —Ö—É–∫"
    ‚Üì
2. LLM –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–µ
   ‚Üí "–¥–æ–±–∞–≤—å —Ö—É–∫" ‚Üí add_hook
    ‚Üì
3. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¢–û–õ–¨–ö–û –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
   ‚Üí –≤–∏–¥–∏—Ç –≤–µ—Å—å –ø–æ—Å—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   ‚Üí –≥–µ–Ω–µ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ —Ö—É–∫, –Ω–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç
    ‚Üì
4. CODE –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ—á–µ—á–Ω–æ
   ‚Üí —Ö—É–∫ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–æ
   ‚Üí —Ö—ç—à—Ç–µ–≥–∏ —É–¥–∞–ª—è—é—Ç—Å—è
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** LLM –≤–∏–¥–∏—Ç –≤—Å—ë, –Ω–æ –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –ø—Ä–æ—Å—è—Ç.

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `agent.py`:
  - `edit_post()` ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º
  - `_parse_edit_intent()` ‚Äî CODE –ø–∞—Ä—Å–∏—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  - `_classify_intent_with_llm()` ‚Äî LLM –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–µ
  - `_generate_edit_content()` ‚Äî LLM –≥–µ–Ω–µ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
  - `_apply_edit_operations()` ‚Äî CODE –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - `_find_with_fuzzy_whitespace()` ‚Äî –Ω–µ—á—ë—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ whitespace (`\n` vs `\n\n`)
  - `fetch_hot_news()` ‚Äî —Ç–µ–ø–µ—Ä—å –±–µ—Ä—ë—Ç –ø–æ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `propose_ideas()` ‚Äî —Ç–µ–ø–µ—Ä—å –ø–∞—Ä—Å–∏—Ç —Å–≤–µ–∂–∏–µ –ø–æ—Å—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- `bot.py`:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üìù –í—Ä—É—á–Ω—É—é" –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ LLM
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ "üí° –ò–¥–µ–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è" ‚Üí `cmd_ideas` (–±—ã–ª–æ `cmd_news`)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è `manual_editing`, `manual_editing_draft`
- `scheduler_tasks.py`:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å ‚Äî `while self._running:` –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ `_run_loop()`
  - –û—Ç–∫–ª—é—á–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã (—Å–ª–∏—à–∫–æ–º –Ω–∞–≤—è–∑—á–∏–≤–æ)
- `plan_manager.py`:
  - –î–æ–±–∞–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω `smm_edit` —Å 5 —à–∞–≥–∞–º–∏

**–û–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```python
OPERATIONS = [
    "add_hook",           # —Ö—É–∫/—Ü–µ–ø–ª—è—é—â–µ–µ –Ω–∞—á–∞–ª–æ
    "delete_paragraph",   # —É–¥–∞–ª–∏—Ç—å –∞–±–∑–∞—Ü
    "rewrite_paragraph",  # –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–±–∑–∞—Ü
    "delete_hashtags",    # —É–±—Ä–∞—Ç—å —Ö—ç—à—Ç–µ–≥–∏
    "add_hashtags",       # –¥–æ–±–∞–≤–∏—Ç—å —Ö—ç—à—Ç–µ–≥–∏
    "add_paragraph",      # –¥–æ–±–∞–≤–∏—Ç—å –∞–±–∑–∞—Ü (after/before/position)
    "bold_text",          # –≤—ã–¥–µ–ª–∏—Ç—å –∂–∏—Ä–Ω—ã–º
    "unbold_text",        # —É–±—Ä–∞—Ç—å –∂–∏—Ä–Ω—ã–π
    "shorten",            # —Å–æ–∫—Ä–∞—Ç–∏—Ç—å
    "expand",             # —Ä–∞—Å—à–∏—Ä–∏—Ç—å
    "replace_text",       # –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç
]
```

**–§–∞–π–ª—ã:** `app/smm/agent.py`, `app/smm/bot.py`, `app/smm/scheduler_tasks.py`, `app/executor/plan_manager.py`

---

### 2025-01-25 (v4): –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–∞ –ø–æ —Å–ª–æ–≤–∞–º + –∞–ª–∏–∞—Å—ã
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `agent.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
  - `_generate_channel_aliases()` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–ª–∏–∞—Å–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞
  - `_translit_to_russian()` ‚Äî –ª–∞—Ç–∏–Ω–∏—Ü–∞ ‚Üí –∫–∏—Ä–∏–ª–ª–∏—Ü–∞
  - `_find_channel_by_keyword()` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –∞–ª–∏–∞—Å–∞–º –≤ metadata
  - `_fuzzy_match()` ‚Äî –Ω–µ—á—ë—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (60% –æ–±—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
  - `_get_translit_variants()` ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ (ou‚Üîow, k‚Üîc)
- `add_competitor()` ‚Äî —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–ª–∏–∞—Å—ã –≤ metadata

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ì–æ–ª–æ—Å: "–≤ —Å—Ç–∏–ª–µ –º–æ—Å–∫–æ—É—Ç–∏–Ω–¥–µ—Ä"
  ‚Üí regex –∏–∑–≤–ª–µ–∫–∞–µ—Ç "–º–æ—Å–∫–æ—É—Ç–∏–Ω–¥–µ—Ä"
  ‚Üí –∏—â–µ–º –≤ metadata.aliases –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
  ‚Üí –Ω–∞—Ö–æ–¥–∏–º "@moscowtinder" (–∞–ª–∏–∞—Å "–º–æ—Å–∫–æ—É—Ç–∏–Ω–¥–µ—Ä")
```

**–§–∞–π–ª—ã:** `app/smm/agent.py`

---

### 2025-01-25 (v3): –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç + —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π —Å—Ç–∏–ª—å –ø–æ —Ç–µ–º–µ
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `step_executor.py`:
  - `_markdown_to_html()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `**text**` ‚Üí `<b>text</b>`
  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ LLM –≤ `_handle_llm_call()` –¥–ª—è smm_generate
  - –£–±—Ä–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–æ HTML –∏–∑ –ø—Ä–æ–º–ø—Ç–æ–≤
- `agent.py`:
  - `_markdown_to_html()` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `edit_post()` –∏ `edit_post_with_history()`
  - `_find_relevant_channel_styles()` ‚Äî FTS5 –ø–æ–∏—Å–∫ —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø–æ —Ç–µ–º–µ
  - `build_smm_context(topic=...)` ‚Äî –∏—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–¢–µ–º–∞: "—Ä–µ—Ç—Ä–æ–≥—Ä–∞–¥–Ω—ã–π –º–µ—Ä–∫—É—Ä–∏–π"
  ‚Üí FTS5 MATCH "—Ä–µ—Ç—Ä–æ–≥—Ä–∞–¥–Ω—ã–π OR –º–µ—Ä–∫—É—Ä–∏–π"
  ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –∫–∞–Ω–∞–ª—ã –ø—Ä–æ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—é
  ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∏—Ö —Å—Ç–∏–ª–∏
```

**–§–∞–π–ª—ã:** `app/executor/step_executor.py`, `app/smm/agent.py`

---

### 2025-01-25 (v2): –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ + –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `scheduler_tasks.py`:
  - `_reanalyze_outdated_channels()` ‚Äî –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–∞–Ω–∞–ª—ã
  - –ù–æ—á–Ω–æ–π —Å–∫–∞–Ω —É—á–∏—Ç—ã–≤–∞–µ—Ç `analysis_version` –≤ metadata
- `smm_tools.py`:
  - `memory_store()` ‚Äî —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `metadata` —Å `analysis_version`
- `step_executor.py`:
  - –î–æ–±–∞–≤–ª—è–µ—Ç `analysis_version: "v2"` –≤ metadata –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–§–∞–π–ª—ã:** `app/smm/scheduler_tasks.py`, `app/tools/smm_tools.py`, `app/executor/step_executor.py`

---

### 2025-01-25 (v1): –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–æ–≤ + UI –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `smm_tools.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `compute_channel_metrics()` (–∞–Ω–∞–ª–∏–∑ –ë–ï–ó LLM)
- `plan_manager.py` ‚Äî smm_analyze: 4 —à–∞–≥–∞ (parse ‚Üí metrics ‚Üí deep_analyze ‚Üí store)
- `step_executor.py` ‚Äî handler `smm_deep_analyze` —Å –≥–æ—Ç–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- `bot.py`:
  - UI –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤: –Ω–∞–∂–∞—Ç–∏–µ ‚Üí –º–µ–Ω—é (–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å/–£–¥–∞–ª–∏—Ç—å)
  - –ö–Ω–æ–ø–∫–∞ "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç –≤ —ç—Ç–æ–º —Å—Ç–∏–ª–µ" –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ `post_topic_styled`
- `plan_manager.py` ‚Äî 50 –ø–æ—Å—Ç–æ–≤ –≤–º–µ—Å—Ç–æ 15 –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

**–§–∞–π–ª—ã:** `app/tools/smm_tools.py`, `app/executor/plan_manager.py`, `app/executor/step_executor.py`, `app/smm/bot.py`

---

### 2025-01-24: SMM Agent –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**
- `agent.py` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Executor ‚Üí Plan ‚Üí Steps
- `plan_manager.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —à–∞–±–ª–æ–Ω—ã smm_generate, smm_analyze
- `step_executor.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã SMM handlers (_build_smm_prompt)
- `schema.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ drafts
- –í—Å–µ 255 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

**–§–∞–π–ª—ã:** `app/smm/agent.py`, `app/executor/plan_manager.py`, `app/executor/step_executor.py`, `app/storage/schema.py`

---

## TODO: –ò–¥–µ–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):

1. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ç—å 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞, —Ç—Ä–µ–∫–∞—Ç—å –∫–∞–∫–æ–π –∑–∞—à—ë–ª –ª—É—á—à–µ
   - Tool: `generate_variants` ‚Üí 3 –≤–µ—Ä—Å–∏–∏
   - Memory: —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
   - –û–±—É—á–µ–Ω–∏–µ: —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ–Ω–∏–º–∞—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫** ‚Äî Scheduler –∑–∞–¥–∞—á–∞
   - –†–∞–∑ –≤ –¥–µ–Ω—å –ø–∞—Ä—Å–∏—Ç—å —Å–≤–æ–π –∫–∞–Ω–∞–ª
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã/—Ä–µ–∞–∫—Ü–∏–∏
   - –°—Ç—Ä–æ–∏—Ç—å —Ç—Ä–µ–Ω–¥—ã

3. **–ö–æ–Ω—Ç–µ–Ω—Ç-–∫–∞–ª–µ–Ω–¥–∞—Ä—å** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é
   - Tool: `plan_content_week` ‚Äî –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ + –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–º
   - UI: –ø–æ–∫–∞–∑ –ø–ª–∞–Ω–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Scheduler: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

4. **–¶–µ–ø–æ—á–∫–∏ –ø–æ—Å—Ç–æ–≤** ‚Äî —Å–µ—Ä–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
   - Plan template: `smm_series` ‚Äî 3-5 –ø–æ—Å—Ç–æ–≤ –Ω–∞ —Ç–µ–º—É
   - Memory: —Å–≤—è–∑—å –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏ —Å–µ—Ä–∏–∏

### UI/UX:

5. **–ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã** ‚Äî –∫–Ω–æ–ø–∫–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ—Å—Ç–æ–≤
   - "–ù–æ–≤–æ—Å—Ç—å", "–õ–∞–π—Ñ—Ö–∞–∫", "–û–ø—Ä–æ—Å", "–ú–Ω–µ–Ω–∏–µ"
   - –ö–∞–∂–¥—ã–π ‚Äî —Å–≤–æ–π Plan template

6. **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –∫–∞–Ω–∞–ª–µ** ‚Äî –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
   - –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å
   - –° —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

7. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –±–æ—Ç–µ** ‚Äî /stats
   - –°–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é
   - –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
   - –õ—É—á—à–∏–π –ø–æ—Å—Ç

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:

8. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞** ‚Äî –Ω–µ –ø–∞—Ä—Å–∏—Ç—å –∫–∞–Ω–∞–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑
   - TTL 24 —á–∞—Å–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
   - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —è–≤–Ω–æ–º /analyze

9. **Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞** ‚Äî Telegram –∏–Ω–æ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç
   - Exponential backoff
   - –ü—Ä–æ–∫—Å–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

10. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ async** ‚Äî agent.py
    - –°–µ–π—á–∞—Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
    - aiogram async, –Ω–æ agent –±–ª–æ–∫–∏—Ä—É–µ—Ç

---

## –ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å –∏ —Ç–∞—Ä–∏—Ñ—ã

### –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (Claude Sonnet 4)

| –û–ø–µ—Ä–∞—Ü–∏—è | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|----------|-----------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ | $0.01-0.03 |
| –ê–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–∞ | $0.02-0.04 |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | $0.005-0.015 |

*–¶–µ–Ω—ã Claude Sonnet 4: $3/1M input, $15/1M output*

### –¢–∞—Ä–∏—Ñ–Ω–∞—è —Å–µ—Ç–∫–∞

| | **Free** | **Pro** | **Business** | **Agency** |
|---|---|---|---|---|
| **–¶–µ–Ω–∞** | 0‚ÇΩ | 1 990‚ÇΩ/–º–µ—Å | 4 990‚ÇΩ/–º–µ—Å | 14 990‚ÇΩ/–º–µ—Å |
| **–ü–æ—Å—Ç–æ–≤/–º–µ—Å** | 10 | 60 | 200 | ‚àû |
| **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã** | 1 | 5 | 15 | ‚àû |
| **–°–∞–π—Ç—ã/RSS** | 0 | 5 | 15 | ‚àû |
| **–ö–∞–Ω–∞–ª–æ–≤** | 1 | 3 | 10 | ‚àû |
| **–ß–µ—Ä–Ω–æ–≤–∏–∫–∏** | 24—á | ‚àû | ‚àû | ‚àû |
| **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **–ê–Ω–∞–ª–∏–∑** | –†—É—á–Ω–æ–π | 1—Ä/–¥–µ–Ω—å | Real-time | Real-time |
| **Twitter –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| **–ú–∞—Ä–∂–∞** | ‚Äî | ~95% | ~93% | ~93% |

### –î–æ–∫—É–ø—ã (—Ç–æ–ª—å–∫–æ Free)

| –î–æ–∫—É–ø | –¶–µ–Ω–∞ |
|-------|------|
| +5 –ø–æ—Å—Ç–æ–≤ | 149‚ÇΩ |
| +1 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç –Ω–∞–≤—Å–µ–≥–¥–∞ | 299‚ÇΩ |
| –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ | 99‚ÇΩ |

### –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è Free ‚Üí Paid

**–ü—Ä–∏–Ω—Ü–∏–ø:** –î–∞—Ç—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –õ–£–ß–®–ï–ï –∫–∞—á–µ—Å—Ç–≤–æ, —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É, –ø–æ—Ç–æ–º ‚Äî –ª–∏–º–∏—Ç.

- 10 –ø–æ—Å—Ç–æ–≤ = ~2 –Ω–µ–¥–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
- –ö–∞—á–µ—Å—Ç–≤–æ –ù–ï —É—Ä–µ–∑–∞–µ–º (—á—Ç–æ–±—ã –≤–ø–µ—á–∞—Ç–ª–∏–ª—Å—è)
- –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ 24—á (–º–æ—Ç–∏–≤–∞—Ü–∏—è –Ω–µ —Ç–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç—É)
- –õ–∏–º–∏—Ç –±—å—ë—Ç –∫–æ–≥–¥–∞ —É–∂–µ –ø—Ä–∏–≤—ã–∫

**–¢—Ä–∏–≥–≥–µ—Ä—ã –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:**
- –°—á—ë—Ç—á–∏–∫: "–û—Å—Ç–∞–ª–æ—Å—å 2 –ø–æ—Å—Ç–∞ –∏–∑ 10"
- –ü–æ—Ç–µ—Ä—è: "–ß–µ—Ä–Ω–æ–≤–∏–∫ —É–¥–∞–ª–∏—Ç—Å—è —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞"
- –ú–æ–º–µ–Ω—Ç –ª–∏–º–∏—Ç–∞: "–ö—É–ø–∏—Ç—å +5 –ø–æ—Å—Ç–æ–≤ –∑–∞ 149‚ÇΩ –∏–ª–∏ –∂–¥–∞—Ç—å 25 –¥–Ω–µ–π"

### –ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞ Agency: "–ü–µ—Ä–≤—ã–π –≤ Telegram"

```
Twitter/X, Reddit, –∑–∞–ø–∞–¥–Ω—ã–µ –°–ú–ò ‚Üí –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω
    ‚Üì
–ù–æ–≤—ã–π —Ç—Ä–µ–Ω–¥ –ø–æ—è–≤–∏–ª—Å—è
    ‚Üì
–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∞–ª–µ—Ä—Ç + –≥–æ—Ç–æ–≤—ã–π –¥—Ä–∞—Ñ—Ç
    ‚Üì
–ö–ª–∏–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç –ø–µ—Ä–≤—ã–º –≤ –†–£-—Å–µ–≥–º–µ–Ω—Ç–µ
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤

- –ß–µ—Ä–µ–∑ `t.me/s/channel` (–≤–µ–±-–≤–µ—Ä—Å–∏—è)
- **–õ–∏–º–∏—Ç: ~20 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å—Ç–æ–≤**
- –î–ª—è –±–æ–ª—å—à–µ –ø–æ—Å—Ç–æ–≤ –Ω—É–∂–µ–Ω Telegram API

### –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

```
–ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–∏–ª –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
    ‚Üì
–£–∂–µ –≤ –∫—ç—à–µ? (< 24—á) ‚Üí –æ—Ç–¥–∞—ë–º –∫—ç—à
    ‚Üì
–ù–µ—Ç ‚Üí –æ—á–µ—Ä–µ–¥—å –Ω–∞ –Ω–æ—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥
    ‚Üì
–ù–æ—á—å—é: 1 –∫–∞–Ω–∞–ª / 30 —Å–µ–∫
    ‚Üì
–£—Ç—Ä–æ–º: —Å–≤–µ–∂–∏–π –∞–Ω–∞–ª–∏–∑ —É –≤—Å–µ—Ö
```

### TODO: Telegram API

- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: telethon –∏–ª–∏ pyrogram
- –ù—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –Ω–æ–º–µ—Ä
- –î–∞—Å—Ç: 100+ –ø–æ—Å—Ç–æ–≤, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã

---

## Troubleshooting

### SSH –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (Connection reset by peer)

**–°–∏–º–ø—Ç–æ–º:** `ssh ubuntu@35.156.188.57` ‚Üí "Connection reset by peer"

**–†–µ—à–µ–Ω–∏—è:**
1. **Reboot —á–µ—Ä–µ–∑ AWS Console:**
   - console.aws.amazon.com ‚Üí EC2 ‚Üí Instances
   - –ù–∞–π—Ç–∏ –∏–Ω—Å—Ç–∞–Ω—Å yadro-smm ‚Üí Actions ‚Üí Reboot

2. **EC2 Instance Connect:**
   - EC2 ‚Üí Instances ‚Üí yadro-smm ‚Üí Connect ‚Üí EC2 Instance Connect

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Security Group:**
   - EC2 ‚Üí Security Groups ‚Üí Inbound rules
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Port 22, Source 0.0.0.0/0

4. **–ï—Å–ª–∏ micro –∏–Ω—Å—Ç–∞–Ω—Å OOM:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `journalctl -u yadro-bot -n 100`
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å upgrade –¥–æ t3.small

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh -i ~/Desktop/yadro-key.pem ubuntu@35.156.188.57

# –°—Ç–∞—Ç—É—Å
sudo systemctl status yadro-bot

# –õ–æ–≥–∏
sudo journalctl -u yadro-bot -f

# –†–µ—Å—Ç–∞—Ä—Ç
sudo systemctl restart yadro-bot
```

### –ù–µ—Ç API –∫–ª—é—á–µ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cat /home/ubuntu/yadro-smm/.env

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# TELEGRAM_BOT_TOKEN=...
# ANTHROPIC_API_KEY=...
```

---

## –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ v7)

–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–≤–∞ —Ä–µ–∂–∏–º–∞:

**1. Precise —Ä–µ–∂–∏–º** (–∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç):
- –£–±—Ä–∞—Ç—å —ç–º–æ–¥–∑–∏ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–ª–∏ –≤—Å–µ)
- –£–¥–∞–ª–∏—Ç—å –∞–±–∑–∞—Ü –ø–æ –Ω–æ–º–µ—Ä—É
- –í—ã–¥–µ–ª–∏—Ç—å –∂–∏—Ä–Ω—ã–º
- –£–±—Ä–∞—Ç—å —Ö—ç—à—Ç–µ–≥–∏

**2. Creative —Ä–µ–∂–∏–º** (LLM –≤–∏–¥–∏—Ç –≤—Å—ë):
- –î–æ–±–∞–≤–∏—Ç—å –∞–±–∑–∞—Ü –º–µ–∂–¥—É X –∏ Y
- –°–¥–µ–ª–∞—Ç—å –∫–æ—Ä–æ—á–µ/–¥–ª–∏–Ω–Ω–µ–µ
- –î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫/–∑–∞—Ü–µ–ø–∫—É
- –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º —Å—Ç–∏–ª–µ

–ö–æ–¥ –≤ `agent.py`: `_is_precise_edit()`, `_precise_edit()`, `_creative_edit()`
